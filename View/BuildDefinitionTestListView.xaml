<UserControl x:Class="TestViewApp.View.BuildDefinitionTestListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:TestViewApp.View"
             xmlns:utility="clr-namespace:TestViewApp.UtilityClasses"
             xmlns:domain="clr-namespace:TestViewApp.Domain"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <Grid DockPanel.Dock="Top">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="20*"/>
            <ColumnDefinition Width="5"/>
            <ColumnDefinition Width="80*"/>
        </Grid.ColumnDefinitions>
        <utility:ExtendedTreeView ItemsSource="{Binding BuildDefinitionList}" SelectedItem_="{Binding SelectedBuildDefinitionItem, Mode=TwoWay}">
            <utility:ExtendedTreeView.ItemTemplate>
                <HierarchicalDataTemplate ItemsSource="{Binding Path=Children}">
                    <TextBlock>
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0}: {1} [Id: {2}]">
                                <Binding Path="Path"/>
                                <Binding Path="Name"/>
                                <Binding Path="Id"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </HierarchicalDataTemplate>
            </utility:ExtendedTreeView.ItemTemplate>
        </utility:ExtendedTreeView>

        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" />

        <Grid Grid.Column="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="30*"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="20*"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="50*"/>
            </Grid.RowDefinitions>
            <DataGrid x:Name="BuildListGrid"
                          ItemsSource="{Binding BuildList}"
                          SelectedItem="{Binding SelectedBuildItem}"
                          AutoGenerateColumns="False"
                          Grid.Row="0"
                          >
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Id" Width="60" Binding="{Binding Id}" IsReadOnly="True" />
                    <DataGridTextColumn Header="BuildNumber" Width="400" Binding="{Binding BuildNumber}" IsReadOnly="True" />
                    <DataGridTextColumn Header="Status" Width="80" Binding="{Binding Status}" IsReadOnly="True" />
                    <DataGridTextColumn Header="Result" Width="80" Binding="{Binding Result}" IsReadOnly="True" />
                    <DataGridTextColumn Header="QueueTime" Width="100" Binding="{Binding QueueTime, StringFormat=\{0:dd-MMM HH:mm:ss\}}" IsReadOnly="True" />
                    <DataGridTextColumn Header="StartTime" Width="100" Binding="{Binding StartTime, StringFormat=\{0:dd-MMM HH:mm:ss\}}" IsReadOnly="True" />
                    <DataGridTextColumn Header="FinishTime" Width="100" Binding="{Binding FinishTime, StringFormat=\{0:dd-MMM HH:mm:ss\}}" IsReadOnly="True" />
                    <DataGridTextColumn Header="Uri" Width="160" Binding="{Binding Uri}" IsReadOnly="True" />
                    <DataGridTextColumn Header="Reason" Width="100" Binding="{Binding Reason}" IsReadOnly="True" />
                    <DataGridTextColumn Header="RequestedFor" Width="200" Binding="{Binding RequestedFor.DisplayName}" IsReadOnly="True" />
                    <DataGridTextColumn Header="RequestedBy" Width="200" Binding="{Binding RequestedBy.DisplayName}" IsReadOnly="True" />
                    <DataGridTextColumn Header="LastChangedBy" Width="200" Binding="{Binding LastChangedBy.DisplayName}" IsReadOnly="True" />
                </DataGrid.Columns>
            </DataGrid>

            <GridSplitter Grid.Row="1" Height="5" VerticalAlignment="Stretch" />

            <!--DataContextChanged="OnMainGrid_DataContextChanged"-->
            <DataGrid x:Name="TestRunListGrid"
                ItemsSource="{Binding TestRunList}"
                SelectedItem="{Binding SelectedTestRunItem}"
                AutoGenerateColumns="False"
                Grid.Row="2"
                
                >
                <DataGrid.Columns>
                    <DataGridTextColumn Header="StartedDate" Binding="{Binding StartedDate}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="CompletedDate" Binding="{Binding CompletedDate}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="StageName" Binding="{Binding PipelineReference.StageReference.StageName}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="State" Binding="{Binding State}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="TotalTests" Binding="{Binding TotalTests}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="PassedTests" Binding="{Binding PassedTests}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="UnanalyzedTests" Binding="{Binding UnanalyzedTests}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Id" Binding="{Binding Id}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Name" Binding="{Binding Name}" IsReadOnly="True"/>
                    <DataGridCheckBoxColumn Header="IsAutomated" Binding="{Binding IsAutomated}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="IncompleteTests" Binding="{Binding IncompleteTests}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="NotApplicableTests" Binding="{Binding NotApplicableTests}" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Substate" Binding="{Binding Substate}" IsReadOnly="True"/>
                </DataGrid.Columns>
            </DataGrid>

            <GridSplitter Grid.Row="3" Height="5" VerticalAlignment="Stretch" />

            <DockPanel Grid.Row="4">
                <DockPanel LastChildFill="False" DockPanel.Dock="Top" Margin="5,0,5,0">
                    <CheckBox IsChecked="{Binding ShowOnlyFailedTestCases}" Margin="0,5,5,5">Show only failed</CheckBox>
                    <TextBlock Text="{Binding TestCasesCount}" DockPanel.Dock="Right" Margin="0,5,5,5"/>
                    <TextBlock DockPanel.Dock="Right" Margin="0,5,5,5">Loaded:</TextBlock>
                </DockPanel>

                <!--DataContextChanged="OnMainGrid_DataContextChanged"-->
                <DataGrid x:Name="TestCaseResultListGrid"
                          ItemsSource="{Binding TestCaseResultList}"
                          SelectedItem="{Binding SelectedTestCaseResultItem}"
                          AutoGenerateColumns="False"
                          >
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="TestCaseTitle" Binding="{Binding TestCaseTitle}" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Outcome" Binding="{Binding Outcome}" IsReadOnly="True"/>
                        <DataGridTextColumn Header="DurationInMs" Binding="{Binding DurationInMs}" IsReadOnly="True"/>
                        <DataGridTextColumn Header="ErrorMessage" Binding="{Binding ErrorMessage}" IsReadOnly="True"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Grid>
    </Grid>
</UserControl>
